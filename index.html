<!-- maincode  -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Blind Stick Dashboard</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/plotly.js/2.26.0/plotly.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
     <style>
        /* Message Styles */
        .message-bubble {
            position: relative;
            transition: all 0.3s ease;
        }

        .message-bubble:hover .message-actions {
            opacity: 1;
        }

        .message-actions {
            position: absolute;
            top: -20px;
            right: 0;
            opacity: 0;
            transition: opacity 0.2s ease;
            display: flex;
            gap: 8px;
            background: white;
            padding: 2px 8px;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .action-button {
            font-size: 12px;
            color: #666;
            background: none;
            border: none;
            cursor: pointer;
            padding: 2px 4px;
            transition: color 0.2s ease;
        }

        .action-button:hover {
            color: #000;
        }

        /* Input Area Styles */
        .input-area {
            display: flex;
            align-items: end;
            padding: 8px 16px;
            border: 1px solid #e2e8f0;
        }

        .textarea-wrapper {
            flex: 1;
            margin: 0 8px;
        }

        .input-textarea {
            width: 100%;
            border: none;
            resize: none;
            max-height: 100px;
            padding: 8px 0;
            outline: none;
            font-size: 15px;
            line-height: 1.4;
        }

        /* Typing Indicator */
        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 12px;
            margin-bottom: 8px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: #b3b3b3;
            border-radius: 50%;
            animation: typing 1s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) { animation-delay: 0.2s; }
        .typing-dot:nth-child(2) { animation-delay: 0.3s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typing {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-4px); }
        }

        /* Audio Controls */
        .audio-controls {
            display: flex;
            gap: 8px;
            padding: 8px;
            background: #f9fafb;
            border-top: 1px solid #e5e7eb;
        }

        .audio-button {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            background: #008069;
            color: white;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .audio-button:hover {
            background: #006e5a;
        }

        .audio-button.recording {
            background: #dc2626;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(220, 38, 38, 0); }
            100% { box-shadow: 0 0 0 0 rgba(220, 38, 38, 0); }
        }

        /* Message Status */
        .status-icon {
            font-size: 12px;
            color: #a0a0a0;
        }

        .status-icon.delivered {
            color: #a0a0a0;
        }

        .status-icon.read {
            color: #34B7F1;
        }

        /* Voice Recording Timer */
        .recording-timer {
            color: #dc2626;
            font-size: 14px;
            margin-left: 8px;
        }
    
    </style>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDNKaWDMEbgOlQsunebgM0o87wzAlxq1A0&libraries=places&callback=initMap" async defer></script>
    <style>
      #map {
    width: 100%;
    height: 400px;
    border-radius: 0.75rem;
    position: relative !important; /* Important position rule */
    overflow: hidden;
}

/* Ensure the map container has proper dimensions */
.map-container {
    width: 100%;
    height: 400px;
    position: relative;
    margin-bottom: 20px;
}

/* Fix for Google Maps controls */
.gm-style-cc {
    display: none;
}

/* Ensure the directions panel is properly styled */
#directions {
    max-height: 400px;
    overflow-y: auto;
    padding: 10px;
}
   
        .chart-container {
            transition: all 0.3s ease;
        }
        .chart-container:hover {
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .section {
            display: none;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }
        
        .section.active {
            display: block;
            opacity: 1;
        }

        .notification {
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .notification.fade-out {
            animation: fadeOut 0.5s ease-in-out forwards;
        }

        @keyframes fadeOut {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(-20px); }
        }

        #notifications-container {
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body class="flex bg-gray-100 min-h-screen">
    <aside class="hidden sm:flex sm:flex-col">
      <a href="#" class="inline-flex items-center justify-center h-20 w-20 bg-purple-600 hover:bg-purple-500 focus:bg-purple-500">
        <svg fill="none" viewBox="0 0 64 64" class="h-12 w-12">
            <title>Parvai</title>
            <image href="https://i.imgur.com/jsDBtZo.png" x="0" y="0" width="64" height="64"/>
        </svg>
    </a>
        <nav class="flex-grow flex flex-col justify-between text-gray-500 bg-gray-800">
            <div class="flex flex-col my-6 space-y-4">
                <a href="#dash" class="nav-link inline-flex items-center justify-center py-3 hover:text-gray-400 hover:bg-gray-700 focus:text-gray-400 focus:bg-gray-700 rounded-lg active">
                    <svg aria-hidden="true" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="h-6 w-6">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                    </svg>
                </a>
                <a href="#eye" class="nav-link inline-flex items-center justify-center py-3 hover:text-gray-400 hover:bg-gray-700 focus:text-gray-400 focus:bg-gray-700 rounded-lg">
                    <svg aria-hidden="true" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="h-6 w-6">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3C7 3 2.5 7 2.5 12S7 21 12 21s9.5-4 9.5-9c0-5-4.5-9-9.5-9zM12 15c-1.5 0-2.5-1-2.5-2.5S10.5 10 12 10s2.5 1 2.5 2.5S13.5 15 12 15z" />
                    </svg>
                </a>
                <a href="#msg" class="nav-link inline-flex items-center justify-center py-3 hover:text-gray-400 hover:bg-gray-700 focus:text-gray-400 focus:bg-gray-700 rounded-lg">
                    <svg aria-hidden="true" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="h-6 w-6">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                    </svg>
                </a>
                <a href="#track" class="nav-link inline-flex items-center justify-center py-3 hover:text-gray-400 hover:bg-gray-700 focus:text-gray-400 focus:bg-gray-700 rounded-lg">
                    <svg aria-hidden="true" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="h-6 w-6">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5a2.5 2.5 0 010-5 2.5 2.5 0 010 5z" />
                    </svg>
                </a>
            </div>
        </nav>
    </aside>
   
    <div class="flex-grow">
        <header class="flex items-center h-20 px-6 bg-white">
            <button class="block sm:hidden relative flex-shrink-0 p-2 mr-2 text-gray-600 hover:bg-gray-100 hover:text-gray-800 focus:bg-gray-100 focus:text-gray-800 rounded-full" id="menu-button">
                <span class="sr-only">Menu</span>
                <svg aria-hidden="true" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="h-6 w-6">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h7" />
                </svg>
            </button>

            <div class="flex flex-shrink-0 items-center ml-auto">
              <button class="inline-flex items-center p-2 hover:bg-gray-100 focus:bg-gray-100 rounded-lg">
                <span class="sr-only">User Menu</span>
                <div class="hidden md:flex md:flex-col md:items-end md:leading-tight">
                  <span class="font-semibold">Guardian</span>
                  <span class="text-sm text-gray-600">Amrita</span>
                </div>
                <span class="h-12 w-12 ml-2 sm:ml-3 mr-2 bg-gray-100 rounded-full overflow-hidden">
                  <img src="https://i.imgur.com/vYzQfmy.jpeg" alt="user profile photo" class="h-full w-full object-cover">
                </span>
                <svg aria-hidden="true" viewBox="0 0 20 20" fill="currentColor" class="hidden sm:block h-6 w-6 text-gray-300">
                  <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                </svg> 
              </button>
              <div class="border-l pl-3 ml-3 space-x-1">
                <button id="notify" class="relative p-2 text-gray-400 hover:bg-gray-100 hover:text-gray-600 focus:bg-gray-100 focus:text-gray-600 rounded-full">
                    <span class="sr-only">Notifications</span>
                    <span class="absolute top-0 right-0 h-2 w-2 mt-1 mr-2 bg-red-500 rounded-full"></span>
                    <span class="absolute top-0 right-0 h-2 w-2 mt-1 mr-2 bg-red-500 rounded-full animate-ping"></span>
                    <svg aria-hidden="true" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="h-6 w-6">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
                      </svg>
                </button>
                <button class="relative p-2 text-gray-400 hover:bg-gray-100 hover:text-gray-600 focus:bg-gray-100 focus:text-gray-600 rounded-full">
                  <span class="sr-only">Log out</span>
                  <svg aria-hidden="true" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="h-6 w-6">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
        </svg>
                </button>
              </div>
            </div>
        </header>

        <!-- Notifications Container -->
        <div id="notifications-container" class="hidden fixed right-4 top-20 w-80 bg-white rounded-lg shadow-lg p-4 z-50">
        </div>

        <!-- Main Content Sections -->
        <main >
            <section id="dash" class="section active">
              <div > 
                <!-- Header Section -->
                <div class="flex flex-col  md:space-y-0 md:flex-row justify-between">
                    <div>
                        <h1 class="text-4xl font-semibold mb-2">Welcome To Dashboard</h1>
                        <h2 class="text-gray-600 ml-0.5">We Provide Free Resources on Smart Blind Stick Technology and Innovations for the Visually Impaired</h2>
                    </div>
                    <div class="flex flex-wrap items-start justify-end -mb-3">
                        <button class="inline-flex px-5 py-3 text-purple-600 hover:text-purple-700 focus:text-purple-700 hover:bg-purple-100 focus:bg-purple-100 border border-purple-600 rounded-md mb-3">
                            <svg aria-hidden="true" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="flex-shrink-0 h-5 w-5 -ml-1 mt-0.5 mr-2">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
                            </svg>
                            Manage User
                        </button>
                        <button class="inline-flex px-5 py-3 text-white bg-purple-600 hover:bg-purple-700 focus:bg-purple-700 rounded-md ml-6 mb-3">
                            <svg aria-hidden="true" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="flex-shrink-0 h-6 w-6 text-white -ml-1 mr-2">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                            </svg>
                            Add new user
                        </button>
                    </div>
                </div>
            
                <!-- Dashboard Grid -->
                <div class="grid md:grid-cols-2 xl:grid-cols-4 xl:grid-rows-3 xl:grid-flow-col gap-6">
                    <!-- Yearly Usage Chart -->
                    <div class="flex flex-col md:col-span-2 md:row-span-2 bg-white shadow rounded-lg chart-container">
                        <div class="px-6 py-5 font-semibold border-b border-gray-100">How many users used the stick per year</div>
                        <div class="p-4 flex-grow">
                            <div id="yearlyChart" style="width:100%; height:200%; margin-top: -50px;" ></div>
                        </div>
                    </div>
            
                    <!-- Stats Cards -->
                    <div class="flex items-center p-8 bg-white shadow rounded-lg">
                        <div class="inline-flex flex-shrink-0 items-center justify-center h-16 w-16 text-yellow-600 bg-yellow-100 rounded-full mr-6">
                            <svg aria-hidden="true" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="h-6 w-6">
                                <path fill="#fff" d="M12 14l9-5-9-5-9 5 9 5z" />
                                <path fill="#fff" d="M12 14l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14z" />
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14l9-5-9-5-9 5 9 5zm0 0l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14zm-4 6v-7.5l4-2.222" />
                            </svg>
                        </div>
                        <div>
                            <span class="block text-2xl font-bold" id="placesCount">25</span>
                            <span class="block text-gray-500">Number of places visited</span>
                        </div>
                    </div>
            
                    <div class="flex items-center p-8 bg-white shadow rounded-lg">
                        <div class="inline-flex flex-shrink-0 items-center justify-center h-16 w-16 text-teal-600 bg-teal-100 rounded-full mr-6">
                            <svg aria-hidden="true" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="h-6 w-6">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                        </div>
                        <div>
                            <span class="block text-2xl font-bold" id="hoursCount">139</span>
                            <span class="block text-gray-500">Number of hours spent on a stick</span>
                        </div>
                    </div>
            
                    <!-- Users List -->
                    <div class="row-span-3 bg-white shadow rounded-lg">
                        <div class="flex items-center justify-between px-6 py-5 font-semibold border-b border-gray-100">
                            <span>Users</span>
                            <button type="button" class="inline-flex justify-center rounded-md px-1 -mr-1 bg-white text-sm leading-5 font-medium text-gray-500 hover:text-gray-600" id="options-menu">
                                User ID
                            </button>
                        </div>
                        <div class="overflow-y-auto" style="max-height: 24rem;" id="usersList">
                            <!-- Users will be dynamically populated here -->
                        </div>
                    </div>
            
                    <!-- Weekly Usage Chart -->
                    <div class="flex flex-col row-span-3 bg-white shadow rounded-lg chart-container">
                        <div class="px-6 py-5 font-semibold border-b border-gray-100">Usage of stick for a week</div>
                        <div class="p-4 flex-grow">
                            <div id="weeklyChart"  style="width:115%; height:120%;"></div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="eye" class="section">
              <h2 class="text-2xl font-bold mb-4">Places Visited</h2>
              <div class="bg-white rounded-lg p-6">
                <!-- Main Image -->
                <div id="up">
                  <img
                    src="https://images.unsplash.com/photo-1499696010180-025ef6e1a8f9?ixlib=rb-4.0.3&amp;ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;auto=format&amp;fit=crop&amp;w=1470&amp;q=80"
                    alt="Main Display"
                  />
                </div>
                <!-- Thumbnails -->
                <div id="down">
                  <img
                    src="https://images.unsplash.com/photo-1499696010180-025ef6e1a8f9?ixlib=rb-4.0.3&amp;ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;auto=format&amp;fit=crop&amp;w=1470&amp;q=80"
                    alt="Thumbnail 1"
                  />
                  <img
                    src="https://images.unsplash.com/photo-1432462770865-65b70566d673?ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;ixlib=rb-1.2.1&amp;auto=format&amp;fit=crop&amp;w=1950&amp;q=80"
                    alt="Thumbnail 2"
                  />
                  <img
                    src="https://images.unsplash.com/photo-1493246507139-91e8fad9978e?ixlib=rb-4.0.3&amp;ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;auto=format&amp;fit=crop&amp;w=2940&amp;q=80"
                    alt="Thumbnail 3"
                  />
                  <img
                    src="https://images.unsplash.com/photo-1518623489648-a173ef7824f3?ixlib=rb-4.0.3&amp;ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;auto=format&amp;fit=crop&amp;w=2762&amp;q=80"
                    alt="Thumbnail 4"
                  />
                  <img
                    src="https://images.unsplash.com/photo-1682407186023-12c70a4a35e0?ixlib=rb-4.0.3&amp;ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;auto=format&amp;fit=crop&amp;w=2832&amp;q=80"
                    alt="Thumbnail 5"
                  />
                  <img
                  src="https://images.unsplash.com/photo-1682407186023-12c70a4a35e0?ixlib=rb-4.0.3&amp;ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;auto=format&amp;fit=crop&amp;w=2832&amp;q=80"
                  alt="Thumbnail 4"
                />
                <img
                src="https://images.unsplash.com/photo-1682407186023-12c70a4a35e0?ixlib=rb-4.0.3&amp;ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;auto=format&amp;fit=crop&amp;w=2832&amp;q=80"
                alt="Thumbnail 3"
              />
              <img
              src="https://images.unsplash.com/photo-1682407186023-12c70a4a35e0?ixlib=rb-4.0.3&amp;ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;auto=format&amp;fit=crop&amp;w=2832&amp;q=80"
              alt="Thumbnail 1"
            />

                </div>
              </div>
            </section>
            

            <!-- Update the msg section in the main code -->
            <section id="msg" class="section p-4">
                <div class="chat-container" style="height: 650px; width: 1300px;">
                    <div class="chat-header">
                        <h1>Message to a blind person</h1>
                        <div class="online-status">PARVAI</div>
                    </div>
                    
                    <div class="messages-container" id="messages-container">
                        <!-- Messages will be added here -->
                        <button class="scroll-button" id="scroll-button">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M12 5v14M19 12l-7 7-7-7"/>
                            </svg>
                        </button>
                    </div>
                    
                    <div class="input-area">
                        <form id="message-form">
                            <div class="input-container">
                                <textarea 
                                    id="message-input"
                                    class="message-input"
                                    placeholder="Type a message"
                                    rows="1"
                                ></textarea>
                                <button type="submit" class="send-button">
                                    <img src="https://i.imgur.com/B2JmTkB.png" width="50px" height="50px">
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </section>
       

    

<!-- Add the required styles -->


<section id="track" class="section">
    <div class="p-6">
        <div class="max-w-4xl mx-auto">
            <h1 class="text-4xl font-semibold mb-2">Search User</h1>
            <h2 class="text-gray-600 ml-0.5 mb-8">With Voice Navigation</h2>
            
            <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                <div id="outdoor-inputs">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Start Latitude</label>
                                <input id="start-lat" type="text" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 outline-none">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Start Longitude</label>
                                <input id="start-lng" type="text" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 outline-none">
                            </div>
                        </div>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Destination Latitude</label>
                                <input id="Dest-lat" type="text" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 outline-none">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Destination Longitude</label>
                                <input id="Dest-lng" type="text" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 outline-none">
                            </div>
                        </div>
                    </div>
                </div>
                
                <button onclick="calculateRoute()" class="mt-6 w-full bg-purple-600 hover:bg-purple-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-300 ease-in-out transform hover:-translate-y-1">
                    Show Route
                </button>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="lg:col-span-2">
                    <div id="map" class="w-full h-[400px] rounded-xl shadow-lg"></div>
                </div>
                <div id="directions" class="bg-white rounded-xl shadow-lg p-4 overflow-auto"></div>
            </div>
        </div>
    </div>
</section>
        </main>
    </div>
    
     <!-- Add Google Maps Script -->
     <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDNKaWDMEbgOlQsunebgM0o87wzAlxq1A0&libraries=places&callback=initMap"></script>
             
    <script>
      // Select all images inside the #down div
      const thumbnails = document.querySelectorAll("#down img");
    
      // Select the main image in the #up div
      const mainImage = document.querySelector("#up img");
    
      // Add click event listener to each thumbnail
      thumbnails.forEach((thumbnail) => {
        thumbnail.addEventListener("click", () => {
          // Update the src of the main image to the clicked thumbnail's src
          mainImage.src = thumbnail.src;
        });
      });
    </script>



<script>
    let map, directionsService, directionsRenderer, geocoder, autocomplete;
    let speechSynthesisUtterance;
    let isAudioPlaying = false;

    async function fetchAndDisplayLocation() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(async (position) => {
                const { latitude, longitude } = position.coords;

                // Fill start latitude and longitude fields
                document.getElementById('start-lat').value = latitude;
                document.getElementById('start-lng').value = longitude;

                // Reverse geocoding
                const apiKey = '7a3b208e6c454919afafe11fb6f36331';
                const apiUrl = `https://api.geoapify.com/v1/geocode/reverse?lat=${latitude}&lon=${longitude}&apiKey=${apiKey}`;

                try {
                    const response = await fetch(apiUrl);
                    const data = await response.json();
                    
                    const formattedAddress = data.features[0].properties.formatted;
                    console.log("Current Location:", formattedAddress);

                    // Firebase imports
                    const { initializeApp } = await import('https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js');
                    const { getFirestore, collection, getDocs, query, orderBy, limit } = await import('https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js');

                    // Firebase configuration
                    const firebaseConfig = {
                        apiKey: "AIzaSyCYLKUR-T2z2LZ2v2liicywsuBhmY3Nz8I",
                        authDomain: "message-blind-stick.firebaseapp.com",
                        projectId: "message-blind-stick",
                        storageBucket: "message-blind-stick.firebasestorage.app",
                        messagingSenderId: "1041278794924",
                        appId: "1:1041278794924:web:1eea3811346ba1d933b309",
                        measurementId: "G-W8PTM3C9B4"
                    };

                    // Initialize Firebase
                    const app = initializeApp(firebaseConfig);
                    const db = getFirestore(app);
                    
                    // Query to fetch the latest destination location
                    const locationsRef = collection(db, "user_locations");
                    const locationsQuery = query(locationsRef, orderBy("timestamp", "desc"), limit(1));
                    
                    const locationsSnapshot = await getDocs(locationsQuery);
                    
                    if (!locationsSnapshot.empty) {
                        const latestLocation = locationsSnapshot.docs[0].data();
                        
                        // Fill destination latitude and longitude fields
                        document.getElementById('Dest-lat').value = latestLocation.latitude;
                        document.getElementById('Dest-lng').value = latestLocation.longitude;
                    }

                } catch (error) {
                    console.error("Error fetching location data:", error);
                    showError("Could not fetch location data");
                }
            }, (error) => {
                console.error("Geolocation error:", error);
                showError("Could not get current location");
            });
        } else {
            showError("Geolocation is not supported by this browser");
        }
    }

    function initMap() {
        // Create the map with specific options
        map = new google.maps.Map(document.getElementById("map"), {
            center: { lat: 37.773972, lng: -122.431297 },
            zoom: 14,
            mapTypeControl: true,
            streetViewControl: true,
            fullscreenControl: true,
            zoomControl: true,
            styles: [
                {
                    "featureType": "water",
                    "elementType": "geometry",
                    "stylers": [{"color": "#e9e9e9"}, {"lightness": 17}]
                },
                {
                    "featureType": "landscape",
                    "elementType": "geometry",
                    "stylers": [{"color": "#f5f5f5"}, {"lightness": 20}]
                }
            ]
        });

        // Initialize required services
        geocoder = new google.maps.Geocoder();
        
        directionsService = new google.maps.DirectionsService();
        directionsRenderer = new google.maps.DirectionsRenderer({
            suppressMarkers: false,
            polylineOptions: {
                strokeColor: "#4F46E5",
                strokeWeight: 5
            }
        });
        directionsRenderer.setMap(map);
        directionsRenderer.setPanel(document.getElementById("directions"));

        // Fetch and display location
        fetchAndDisplayLocation();
    }

    function calculateRoute() {
        const startLat = parseFloat(document.getElementById('start-lat').value);
        const startLng = parseFloat(document.getElementById('start-lng').value);
        const destLat = parseFloat(document.getElementById('Dest-lat').value);
        const destLng = parseFloat(document.getElementById('Dest-lng').value);

        if (isNaN(startLat) || isNaN(startLng) || isNaN(destLat) || isNaN(destLng)) {
            showError("Please enter valid coordinates");
            return;
        }

        const start = new google.maps.LatLng(startLat, startLng);
        const destination = new google.maps.LatLng(destLat, destLng);

        const request = {
            origin: start,
            destination: destination,
            travelMode: 'WALKING'
        };

        directionsService.route(request, (result, status) => {
            if (status === 'OK') {
                directionsRenderer.setDirections(result);
                readDirections(result);
            } else {
                showError('Directions request failed due to ' + status);
            }
        });
    }

    function showError(message) {
        const errorDiv = document.createElement('div');
        errorDiv.className = 'fixed top-4 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg';
        errorDiv.textContent = message;
        document.body.appendChild(errorDiv);
        
        setTimeout(() => errorDiv.remove(), 3000);
    }

    function readDirections(result) {
        const steps = result.routes[0].legs[0].steps;
        const directionsText = steps.map(step => step.instructions.replace(/<[^>]*>/g, "")).join(". ");
        // Implement text-to-speech functionality here if needed
        console.log(directionsText);
    }
</script>

<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDNKaWDMEbgOlQsunebgM0o87wzAlxq1A0&libraries=places&callback=initMap"></script>

   <style>
  .section {
    padding: 20px;
  }

  /* Main Container */
  .bg-white {
    background-color: white;
    border-radius: 8px;
    padding: 20px;
  }

  /* Image at the top */
  #up img {
    width: 100%;
    max-height: 420px;
    object-fit: cover;
    border-radius: 8px;
  }

  /* Thumbnail Container */
  #down {
    display: flex; /* Flexbox for horizontal layout */
    gap: 8px; /* Space between items */
    overflow-x: auto; /* Enable horizontal scrolling */
    padding: 10px 0;
  }

  #down::-webkit-scrollbar {
    height: 8px; /* Custom scrollbar height */
  }

  #down::-webkit-scrollbar-thumb {
    background-color: #ccc; /* Thumb color */
    border-radius: 4px; /* Rounded edges */
  }

  #down::-webkit-scrollbar-track {
    background-color: #f0f0f0; /* Track color */
  }

  /* Thumbnail Images */
  #down img {
    height: 80px; /* Fixed height for thumbnails */
    width: auto; /* Maintain aspect ratio */
    border-radius: 8px;
    cursor: pointer;
    flex-shrink: 0; /* Prevent shrinking */
    transition: transform 0.2s;
  }

  #down img:hover {
    transform: scale(1.1); /* Slight zoom on hover */
  }

  /* Responsive Adjustments */
  @media (max-width: 768px) {
    #up img {
      max-height: 200px;
    }

    #down img {
      height: 60px; /* Smaller thumbnails for smaller screens */
    }
  }
  </style>
  
    
    <script>
        // Navigation handling
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const targetId = link.getAttribute('href').substring(1);
                showSection(targetId);
                
                // Update active state
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('text-purple-600', 'bg-white'));
                link.classList.add('text-purple-600', 'bg-white');
            });
        });

        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(sectionId).classList.add('active');
        }

        // Mobile menu handling
        const menuButton = document.getElementById('menu-button');
        const aside = document.querySelector('aside');
        
        menuButton.addEventListener('click', () => {
            aside.classList.toggle('hidden');
        });

        // Notifications system
        const notificationBtn = document.getElementById('notification-btn');
        const notificationsContainer = document.getElementById('notifications-container');
        
        // Sample notifications data
        const notifications = [
            { username: 'John Doe', userId: '001', message: 'New location alert' },
            { username: 'Jane Smith', userId: '002', message: 'Battery low warning' }
        ];

        notificationBtn.addEventListener('click', () => {
            notificationsContainer.classList.toggle('hidden');
            
            // Clear existing notifications
            notificationsContainer.innerHTML = '';
            
            // Add notifications
            notifications.forEach(notification => {
                const notificationElement = document.createElement('div');
                notificationElement.className = 'notification bg-gray-50 p-4 mb-2 rounded-lg relative';
                notificationElement.innerHTML = `
                    <button class="absolute top-2 right-2 text-gray-500 hover:text-gray-700 close-notification">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                    <p class="text-gray-500">${notification.username}</p>
                    <p class="text-sm text-gray-400">ID: ${notification.userId}</p>
                    <p class="mt-1">${notification.message}</p>
                `;
                notificationsContainer.appendChild(notificationElement);
            });

            // Add close notification functionality
            document.querySelectorAll('.close-notification').forEach(button => {
                button.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const notificationElement = button.closest('.notification');
                    notificationElement.classList.add('fade-out');
                    setTimeout(() => {
                        notificationElement.remove();
                        if (notificationsContainer.children.length === 0) {
                            notificationsContainer.classList.add('hidden');
                        }
                    }, 500);
                });
            });
        });

        // Close notifications when clicking outside
        document.addEventListener('click', (e) => {
            if (!notificationsContainer.contains(e.target) && 
                !notificationBtn.contains(e.target)) {
                notificationsContainer.classList.add('hidden');
            }
        });
    </script>

<script>
  // Generate random data for yearly usage
  function generateYearlyData() {
      const years = ['2020', '2021', '2022', '2023', '2024'];
      const users = years.map(() => Math.floor(Math.random() * 500 + 300));
      return { years, users };
  }

  // Generate random data for weekly usage
  function generateWeeklyData() {
      const days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
      const hours = days.map(() => Math.floor(Math.random() * 8 + 4));
      return { days, hours };
  }

  // Generate random user data
  function generateUsers() {
      const countries = ['United States', 'Spain', 'United Kingdom', 'Malaysia', 'Russia', 'Canada', 'India', 'Australia'];
      const users = countries.map(country => ({
          country: country,
          score: (Math.random() * 2 + 7).toFixed(1)
      }));
      return users.sort((a, b) => b.score - a.score);
  }

  // Update statistics
  function updateStats() {
      document.getElementById('placesCount').textContent = Math.floor(Math.random() * 10 + 20);
      document.getElementById('hoursCount').textContent = Math.floor(Math.random() * 50 + 100);
  }

  // Update users list
  function updateUsersList() {
      const users = generateUsers();
      const usersList = document.getElementById('usersList');
      usersList.innerHTML = users.map(user => `
          <li class="flex items-center p-6 border-b border-gray-100">
              
              <span class="text-gray-600">${user.country}</span>
              <span class="ml-auto font-semibold">${user.score}</span>
          </li>
      `).join('');
  }

  window.onload = function() {
      // Initialize yearly chart
      const yearlyData = generateYearlyData();
      const yearlyTrace = {
          x: yearlyData.years,
          y: yearlyData.users,
          type: 'scatter',
          mode: 'lines+markers',
          line: {
              color: 'rgb(147, 51, 234)',
              width: 3
          },
          marker: {
              size: 8,
              color: 'rgb(147, 51, 234)'
          }
      };

      const yearlyLayout = {
          autosize: true,
          margin: { t: 60, r: 40, l: 60, b: 60 },
          xaxis: { title: 'Year' },
          yaxis: { title: 'Number of Users' },
          paper_bgcolor: 'rgba(0,0,0,0)',
          plot_bgcolor: 'rgba(0,0,0,0)',
          transition: {
              duration: 1000,
              easing: 'cubic-in-out'
          }
      };

      Plotly.newPlot('yearlyChart', [yearlyTrace], yearlyLayout, { responsive: true });

      // Initialize weekly chart
      const weeklyData = generateWeeklyData();
const weeklyTrace = {
    x: weeklyData.days,
    y: weeklyData.hours,
    type: 'scatter', // Change to scatter for a line chart
    mode: 'lines+markers', // Add markers along with lines
    line: {
        color: 'rgb(147, 51, 234)',
        width: 3
    },
    marker: {
        size: 8,
        color: 'rgb(147, 51, 234)'
    }
};

const weeklyLayout = {
    autosize: true,
    margin: { t: 40, r: 20, l: 50, b: 40 }, // Increase the left margin (l) for better spacing
    xaxis: { title: 'Day of Week' },
    yaxis: {
        title: 'Hours Used',
        titlefont: {
            size: 14 // Optional: Adjust font size for better visibility
        },
        automargin: true, // Automatically add space for y-axis title
        tickpadding: 10 // Add space between ticks and axis labels
    },
    paper_bgcolor: 'rgba(0,0,0,0)',
    plot_bgcolor: 'rgba(0,0,0,0)',
    transition: {
        duration: 1000,
        easing: 'cubic-in-out'
    }
};


Plotly.newPlot('weeklyChart', [weeklyTrace], weeklyLayout, { responsive: true });

      // Initial users list
      updateUsersList();

      // Update everything periodically
      setInterval(() => {
          const newYearlyData = generateYearlyData();
          Plotly.animate('yearlyChart', {
              data: [{y: newYearlyData.users}],
              traces: [0],
              layout: {}
          }, {
              transition: {
                  duration: 500,
                  easing: 'cubic-in-out'
              }
          });

          const newWeeklyData = generateWeeklyData();
          Plotly.animate('weeklyChart', {
              data: [{y: newWeeklyData.hours}],
              traces: [0],
              layout: {}
          }, {
              transition: {
                  duration: 500,
                  easing: 'cubic-in-out'
              }
          });

          updateStats();
          updateUsersList();
      }, 5000);

      // Handle window resize
      window.addEventListener('resize', () => {
          Plotly.Plots.resize('yearlyChart');
          Plotly.Plots.resize('weeklyChart');
      });
  }
</script>
     
            
<style>
    .chat-container {
width: 100%;
max-width: 1800px;
height: 80vh;
background: white;
border-radius: 12px;
overflow: hidden;
display: flex;
flex-direction: column;
box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.chat-header {
background: #806fe2;
color: white;
padding: 16px;
}

.chat-header h1 {
font-size: 1.25rem;
margin-bottom: 4px;
}

.online-status {
font-size: 0.875rem;
opacity: 0.8;
}

.messages-container {
flex: 1;
overflow-y: auto;
padding: 16px;
background: #f0f2f5;
position: relative;
}

.message {
margin-bottom: 16px;
max-width: 70%;
animation: slideIn 0.3s ease-out;
}

.message.sent {
margin-left: auto;
background: #dcf8c6;
}

.message.received {
margin-right: auto;
background: white;
}

.message-bubble {
padding: 12px;
border-radius: 8px;
position: relative;
box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}

.message-time {
font-size: 0.75rem;
color: #667781;
text-align: right;
margin-top: 4px;
}

.input-area {
padding: 16px;
background: #f0f2f5;
border-top: 1px solid #e0e0e0;
}

.input-container {
display: flex;
gap: 8px;
width: 900px;
align-items: flex-end;
}

.message-input {
flex: 1;

padding: 12px;
border: none;
border-radius: 16px;
resize: none;
outline: none;
max-height: 120px;
box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}

.send-button {
background: #7f66dc;
color: white;
border: none;
border-radius: 50%;
width: 48px;
height: 48px;
cursor: pointer;
display: flex;
align-items: center;
justify-content: center;
transition: background-color 0.2s;
}

.send-button:hover {
background: #006e5a;
}

.scroll-button {
position: absolute;
bottom: 24px;
right: 24px;
background: white;
border: none;
border-radius: 50%;
width: 40px;
height: 40px;
cursor: pointer;
display: none;
align-items: center;
justify-content: center;
box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
transition: all 0.2s;
}

.scroll-button:hover {
background: #f3f4f6;
}

@keyframes slideIn {
from {
   transform: translateY(20px);
   opacity: 0;
}
to {
   transform: translateY(0);
   opacity: 1;
}
}

/* Custom scrollbar */
.messages-container::-webkit-scrollbar {
width: 6px;
}

.messages-container::-webkit-scrollbar-track {
background: transparent;
}

.messages-container::-webkit-scrollbar-thumb {
background: #bbb;
border-radius: 3px;
}

.messages-container::-webkit-scrollbar-thumb:hover {
background: #999;
}
</style>
<script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js';
import { 
    getFirestore, 
    collection, 
    addDoc, 
    query, 
    orderBy, 
    onSnapshot,
    getDocs 
} from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js';

const firebaseConfig = {
    apiKey: "AIzaSyCYLKUR-T2z2LZ2v2liicywsuBhmY3Nz8I",
    authDomain: "message-blind-stick.firebaseapp.com",
    projectId: "message-blind-stick",
    storageBucket: "message-blind-stick.firebasestorage.app",
    messagingSenderId: "1041278794924",
    appId: "1:1041278794924:web:1eea3811346ba1d933b309",
    measurementId: "G-W8PTM3C9B4"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// Chat Elements
const chatMessagesContainer = document.getElementById('messages-container');
const messageForm = document.getElementById('message-form');
const messageInput = document.getElementById('message-input');
const notifyButton = document.getElementById('notify');

let currentDateDivider = null;
let transcriptSubscription = null;
let messageSubscription = null;

// Transcript Handling Functions
async function fetchTranscripts() {
    const transcriptQuery = query(
        collection(db, 'transcriptions'),
        orderBy('timestamp', 'asc')
    );

    try {
        const querySnapshot = await getDocs(transcriptQuery);
        return querySnapshot.docs.map(doc => ({
            id: doc.id,
            ...doc.data()
        }));
    } catch (error) {
        console.error('Error fetching transcripts:', error);
        throw error;
    }
}

function subscribeToTranscripts(callback) {
    const transcriptQuery = query(
        collection(db, 'transcriptions'),
        orderBy('timestamp', 'asc')
    );

    return onSnapshot(transcriptQuery, (snapshot) => {
        const transcripts = snapshot.docs.map(doc => ({
            id: doc.id,
            ...doc.data()
        }));
        callback(transcripts);
    });
}

// Date and Time Formatting Functions
function parseFirebaseTimestamp(timestamp) {
    if (typeof timestamp === 'string') {
        const regex = /^(\w+ \d+, \d+) at (\d+:\d+:\d+ [AP]M) GMT\+5:30$/;
        const match = timestamp.match(regex);

        if (match) {
            const [_, datePart, timePart] = match;
            const dateTimeStr = `${datePart} ${timePart}`;
            return new Date(dateTimeStr);
        }
    }

    if (timestamp instanceof Date) {
        return timestamp;
    }

    console.warn('Invalid timestamp format:', timestamp);
    return new Date();
}

function formatDateDivider(date) {
    const today = new Date();
    const yesterday = new Date(today);
    yesterday.setDate(yesterday.getDate() - 1);

    if (date.toDateString() === today.toDateString()) return 'Today';
    if (date.toDateString() === yesterday.toDateString()) return 'Yesterday';
    return date.toLocaleDateString('en-US', {
        year: 'numeric',
        month: 'long',
        day: 'numeric'
    });
}

function formatMessageTime(date) {
    return date.toLocaleTimeString('en-US', {
        hour: '2-digit',
        minute: '2-digit',
        hour12: true
    });
}
function addDateDivider(date) {
    const dividerDate = date.toDateString();
    if (currentDateDivider !== dividerDate) {
        currentDateDivider = dividerDate;

        const divider = document.createElement('div');
        divider.classList.add(
            'flex', 
            'justify-center', 
            'my-4', 
            'text-gray-500', 
            'text-sm', 
            'font-medium'
        );
        const span = document.createElement('span');
        span.textContent = formatDateDivider(date);
        divider.appendChild(span);

        chatMessagesContainer.appendChild(divider);
    }
}

function createChatMessage(message, isReceived) {
    const date = parseFirebaseTimestamp(message.timestamp);
    addDateDivider(date);

    // Create the outer message div
    const messageDiv = document.createElement('div');
    messageDiv.classList.add(
        'flex', 
        isReceived ? 'justify-start' : 'justify-end', 
        'mb-4'
    );

    // Create the message bubble
    const messageBubble = document.createElement('div');
    messageBubble.classList.add(
        'rounded-lg', 
        'p-3', 
        'max-w-[70%]', 
        'shadow',
        isReceived ? 'bg-white' : 'bg-[#dcf8c6]'
    );

    // Add the message text
    const messageText = document.createElement('p');
    messageText.classList.add('text-gray-800', 'text-[15px]');
    messageText.textContent = message.text;
    messageBubble.appendChild(messageText);

    // Create the timestamp container
    const timestampContainer = document.createElement('div');
    timestampContainer.classList.add(
        'flex', 
        'items-center', 
        'justify-end', 
        'gap-1', 
        'mt-1'
    );

    // Add the timestamp
    const timestamp = document.createElement('span');
    timestamp.classList.add('text-xs', 'text-gray-500');
    timestamp.textContent = formatMessageTime(date);
    timestampContainer.appendChild(timestamp);

    // Add the double tick icon for sent messages
    if (!isReceived) {
        const doubleTick = document.createElement('span');
        doubleTick.classList.add('text-[#34B7F1]');
        doubleTick.textContent = '✓✓';
        timestampContainer.appendChild(doubleTick);
    }

    // Append the timestamp container to the message bubble
    messageBubble.appendChild(timestampContainer);

    // Append the message bubble to the outer div
    messageDiv.appendChild(messageBubble);

    return messageDiv;
}


function scrollToBottom() {
    chatMessagesContainer.scrollTop = chatMessagesContainer.scrollHeight;
}

// Notification Functions
function createNotificationMessage(message, isIncoming) {
    const messageDiv = document.createElement('div');
    messageDiv.className = 'px-4 py-3 hover:bg-gray-50 border-b border-gray-200';
    
    const messageContent = document.createElement('div');
    messageContent.className = 'flex items-start';
    
    const textContent = document.createElement('div');
    textContent.className = 'ml-3';
    
    const messageType = document.createElement('p');
    messageType.className = 'text-sm font-medium text-gray-900';
    messageType.textContent = isIncoming ? 'Incoming Message' : 'Sent Message';
    
    const messageText = document.createElement('p');
    messageText.className = 'text-sm text-gray-500';
    messageText.textContent = message.text || 'No message content';
    
    const timeStamp = document.createElement('p');
    timeStamp.className = 'text-xs text-gray-400 mt-1';
    const date = parseFirebaseTimestamp(message.timestamp);
    timeStamp.textContent = date.toLocaleString();
    
    textContent.appendChild(messageType);
    textContent.appendChild(messageText);
    textContent.appendChild(timeStamp);
    messageContent.appendChild(textContent);
    messageDiv.appendChild(messageContent);
    
    return messageDiv;
}

function createNotificationDropdown() {
    const menu = document.createElement('div');
    menu.className = 'absolute right-0 mt-2 w-80 bg-white rounded-lg shadow-lg py-1 z-50 hidden';
    menu.id = 'notification-dropdown';
    
    const header = document.createElement('div');
    header.className = 'px-4 py-2 border-b border-gray-200';
    header.innerHTML = '<h3 class="text-lg font-semibold">Notifications</h3>';
    
    const notificationList = document.createElement('div');
    notificationList.className = 'max-h-96 overflow-y-auto';
    notificationList.id = 'notification-list';
    
    menu.appendChild(header);
    menu.appendChild(notificationList);
    return menu;
}

// Initialize Functions
async function initializeChat() {
    // Load existing transcripts
    const existingTranscripts = await fetchTranscripts();
    existingTranscripts.forEach(transcript => {
        const messageElement = createChatMessage(transcript, true);
        chatMessagesContainer.appendChild(messageElement);
    });

    // Subscribe to new transcripts
    transcriptSubscription = subscribeToTranscripts((transcripts) => {
        chatMessagesContainer.innerHTML = ''; // Clear existing messages
        transcripts.forEach(transcript => {
            const messageElement = createChatMessage(transcript, true);
            chatMessagesContainer.appendChild(messageElement);
        });
        scrollToBottom();
    });

    // Subscribe to sent messages
    const sentMessagesQuery = query(
        collection(db, 'message-send'),
        orderBy('timestamp', 'asc')
    );

    messageSubscription = onSnapshot(sentMessagesQuery, (snapshot) => {
        snapshot.docChanges().forEach((change) => {
            if (change.type === 'added') {
                const message = change.doc.data();
                const messageElement = createChatMessage(message, false);
                chatMessagesContainer.appendChild(messageElement);
                scrollToBottom();
            }
        });
    });
}

function initializeNotifications() {
    if (!notifyButton) return;

    const dropdown = createNotificationDropdown();
    notifyButton.parentNode.appendChild(dropdown);
    
    const notificationList = document.getElementById('notification-list');
    
    // Toggle dropdown
    notifyButton.addEventListener('click', (event) => {
        event.stopPropagation();
        dropdown.classList.toggle('hidden');
        
        // Hide notification dots
        const notificationDots = notifyButton.querySelectorAll('.bg-red-500');
        notificationDots.forEach(dot => dot.classList.add('hidden'));
    });
    
    // Close dropdown when clicking outside
    document.addEventListener('click', (event) => {
        if (!notifyButton.contains(event.target) && !dropdown.contains(event.target)) {
            dropdown.classList.add('hidden');
        }
    });
    
    // Subscribe to transcripts for notifications
    const transcriptionsQuery = query(
        collection(db, 'transcriptions'),
        orderBy('timestamp', 'desc')
    );
    
    onSnapshot(transcriptionsQuery, (snapshot) => {
        const isDropdownHidden = dropdown.classList.contains('hidden');
        
        snapshot.docChanges().forEach((change) => {
            if (change.type === 'added') {
                const message = change.doc.data();
                const messageElement = createNotificationMessage(message, true);
                notificationList.insertBefore(messageElement, notificationList.firstChild);
                
                if (isDropdownHidden) {
                    const notificationDots = notifyButton.querySelectorAll('.bg-red-500');
                    notificationDots.forEach(dot => dot.classList.remove('hidden'));
                }
            }
        });
    });
}

// Event Listeners
messageForm?.addEventListener('submit', async (e) => {
    e.preventDefault();
    const messageText = messageInput.value.trim();

    if (messageText) {
        try {
            const now = new Date();
            const formattedDate = now.toLocaleDateString('en-US', {
                month: 'long',
                day: 'numeric',
                year: 'numeric'
            });
            const formattedTime = now.toLocaleTimeString('en-US', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: true
            });
            const timestamp = `${formattedDate} at ${formattedTime} GMT+5:30`;

            await addDoc(collection(db, 'message-send'), {
                text: messageText,
                timestamp: timestamp
            });

            messageInput.value = '';
            messageInput.style.height = 'auto';
        } catch (error) {
            console.error('Error sending message:', error);
        }
    }
});

messageInput?.addEventListener('input', () => {
    messageInput.style.height = 'auto';
    messageInput.style.height = `${messageInput.scrollHeight}px`;
});

// Cleanup function
function cleanup() {
    if (transcriptSubscription) {
        transcriptSubscription();
    }
    if (messageSubscription) {
        messageSubscription();
    }
}

// Initialize everything when DOM is loaded
document.addEventListener('DOMContentLoaded', () => {
    initializeChat();
    initializeNotifications();
});

// Add custom scrollbar styles
const style = document.createElement('style');
style.textContent = `
    .max-h-96::-webkit-scrollbar {
        width: 4px;
    }

    .max-h-96::-webkit-scrollbar-track {
        background: #f1f1f1;
    }

    .max-h-96::-webkit-scrollbar-thumb {
        background: #888;
        border-radius: 2px;
    }

    .max-h-96::-webkit-scrollbar-thumb:hover {
        background: #555;
    }
`;
document.head.appendChild(style);

// Handle cleanup when page is unloaded
window.addEventListener('unload', cleanup);
</script>
</body>
</html>